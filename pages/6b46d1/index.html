<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Kubernetes基础知识 | 不爱吃鸭脖</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="晋华的个人博客">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.d9c8cf8c.css" as="style"><link rel="preload" href="/assets/js/app.7087f587.js" as="script"><link rel="preload" href="/assets/js/2.e7663ce2.js" as="script"><link rel="preload" href="/assets/js/3.c4ac17a7.js" as="script"><link rel="prefetch" href="/assets/js/10.1f7e226f.js"><link rel="prefetch" href="/assets/js/11.f6e4b5e5.js"><link rel="prefetch" href="/assets/js/12.fc105dd9.js"><link rel="prefetch" href="/assets/js/13.af686786.js"><link rel="prefetch" href="/assets/js/14.b8a0a679.js"><link rel="prefetch" href="/assets/js/15.28175aeb.js"><link rel="prefetch" href="/assets/js/16.5de6a1ae.js"><link rel="prefetch" href="/assets/js/17.83f91d5b.js"><link rel="prefetch" href="/assets/js/18.c25ff30b.js"><link rel="prefetch" href="/assets/js/19.9eb4ef0f.js"><link rel="prefetch" href="/assets/js/20.6a684d39.js"><link rel="prefetch" href="/assets/js/21.95b0c4ac.js"><link rel="prefetch" href="/assets/js/22.e5cf9121.js"><link rel="prefetch" href="/assets/js/23.8d6ef789.js"><link rel="prefetch" href="/assets/js/24.83813c9e.js"><link rel="prefetch" href="/assets/js/25.669474a8.js"><link rel="prefetch" href="/assets/js/26.3287bee0.js"><link rel="prefetch" href="/assets/js/27.3841e5e7.js"><link rel="prefetch" href="/assets/js/28.cb5633ac.js"><link rel="prefetch" href="/assets/js/29.a1a1cb6d.js"><link rel="prefetch" href="/assets/js/30.52a15d68.js"><link rel="prefetch" href="/assets/js/31.a07d8889.js"><link rel="prefetch" href="/assets/js/32.d09edb84.js"><link rel="prefetch" href="/assets/js/33.06ef6d42.js"><link rel="prefetch" href="/assets/js/34.6da289f6.js"><link rel="prefetch" href="/assets/js/35.ee22a4e9.js"><link rel="prefetch" href="/assets/js/36.8d8c7fba.js"><link rel="prefetch" href="/assets/js/37.b28f22e1.js"><link rel="prefetch" href="/assets/js/4.242d147b.js"><link rel="prefetch" href="/assets/js/5.b37386e0.js"><link rel="prefetch" href="/assets/js/6.ccd319ae.js"><link rel="prefetch" href="/assets/js/7.80d5da9b.js"><link rel="prefetch" href="/assets/js/8.47418624.js"><link rel="prefetch" href="/assets/js/9.e059bdba.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9c8cf8c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="不爱吃鸭脖" class="logo"> <span class="site-name can-hide">不爱吃鸭脖</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/a9075a/" class="nav-link">Java</a></div><div class="nav-item"><a href="/pages/bc95b0/" class="nav-link">算法</a></div><div class="nav-item"><a href="/pages/6b46d1/" aria-current="page" class="nav-link router-link-exact-active router-link-active">k8s</a></div><div class="nav-item"><a href="/pages/652125/" class="nav-link">日常</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/jinhua0" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="/img/logo.png"> <div class="blogger-info"><h3>不爱吃鸭脖</h3> <span>小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><a href="/pages/a9075a/" class="nav-link">Java</a></div><div class="nav-item"><a href="/pages/bc95b0/" class="nav-link">算法</a></div><div class="nav-item"><a href="/pages/6b46d1/" aria-current="page" class="nav-link router-link-exact-active router-link-active">k8s</a></div><div class="nav-item"><a href="/pages/652125/" class="nav-link">日常</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/jinhua0" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><a href="/pages/6b46d1/" aria-current="page" class="active sidebar-link">Kubernetes基础知识</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_1-1-应用部署方式演变" class="sidebar-link">1.1 应用部署方式演变</a></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_1-2-kubernetes简介" class="sidebar-link">1.2 kubernetes简介</a></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_1-3-kubernetes组件" class="sidebar-link">1.3 kubernetes组件</a></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_1-4-kubernetes概念" class="sidebar-link">1.4 kubernetes概念</a></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_3-1-yaml语言介绍" class="sidebar-link">3.1 YAML语言介绍</a></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_3-2-资源管理方式" class="sidebar-link">3.2 资源管理方式</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_3-2-1-命令式对象管理" class="sidebar-link">3.2.1 命令式对象管理</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_3-2-2-命令式对象配置" class="sidebar-link">3.2.2 命令式对象配置</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_3-2-3-声明式对象配置" class="sidebar-link">3.2.3 声明式对象配置</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_4-1-namespace" class="sidebar-link">4.1 Namespace</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-1-1-查看" class="sidebar-link">4.1.1 查看</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-1-2-创建" class="sidebar-link">4.1.2 创建</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-1-3-删除" class="sidebar-link">4.1.3 删除</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_4-2-pod" class="sidebar-link">4.2 Pod</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-2-1-创建并运行" class="sidebar-link">4.2.1 创建并运行</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-2-2-查看pod信息" class="sidebar-link">4.2.2 查看Pod信息</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-2-3-访问pod" class="sidebar-link">4.2.3 访问Pod</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-2-4-删除指定pod" class="sidebar-link">4.2.4 删除指定Pod</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-2-5-配置操作" class="sidebar-link">4.2.5 配置操作</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_4-3-label" class="sidebar-link">4.3 Label</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-3-1-命令方式" class="sidebar-link">4.3.1 命令方式</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-3-2-配置方式" class="sidebar-link">4.3.2 配置方式</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_4-4-deployment" class="sidebar-link">4.4 Deployment</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-4-1-命令操作" class="sidebar-link">4.4.1 命令操作</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-4-2-配置操作" class="sidebar-link">4.4.2 配置操作</a></li></ul></li><li class="sidebar-sub-header level2"><a href="/pages/6b46d1/#_4-5-service" class="sidebar-link">4.5 Service</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-5-1-创建集群内部可访问的service" class="sidebar-link">4.5.1 创建集群内部可访问的Service</a></li><li class="sidebar-sub-header level3"><a href="/pages/6b46d1/#_4-5-2-创建集群外部也可访问的service" class="sidebar-link">4.5.2 创建集群外部也可访问的Service</a></li><li class="sidebar-sub-header level4"><a href="/pages/6b46d1/#_4-5-4-配置方式" class="sidebar-link">4.5.4 配置方式</a></li></ul></li></ul></li><li><a href="/pages/08838f/" class="sidebar-link">Pod相关</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/categories/?category=k8s" title="分类" data-v-06225672>k8s</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/jinhua0" target="_blank" title="作者" class="beLink" data-v-06225672>jinhua</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-06-18</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">Kubernetes基础知识<!----></h1>  <div class="theme-vdoing-content content__default"><p>我计划在k8s集群基础上搭建一个融合prometheue+grafana的监控系统，用于监控集群中各节点的运行情况，以便之后更加深入的研究k8s的各个组件。</p> <h1 id="_1-kubernetes介绍"><a href="#_1-kubernetes介绍" class="header-anchor">#</a> 1 Kubernetes介绍</h1> <h2 id="_1-1-应用部署方式演变"><a href="#_1-1-应用部署方式演变" class="header-anchor">#</a> 1.1 应用部署方式演变</h2> <ul><li><p>传统部署：应用程序直接部署在物理机上</p> <ul><li>优点：简单</li> <li>缺点：不能为应用程序定义资源使用边界，不能隔离应用程序，很难合理分配计算资源。</li></ul></li> <li><p>虚拟化部署：可以在一个物理机上运行多个虚拟机，每个都是独立的一个环境。</p> <ul><li>优点：应用程序相互隔离，提供了一定程度的安全性</li> <li>缺点：虚拟机部署会在宿主机上安装一个虚拟操作系统，这个操作系统会占用一部分宿主机资源，增加一些额外的资源消耗</li></ul></li> <li><p>容器化部署：与虚拟化类似，但是共享了宿主机的操作系统</p> <ul><li>优点：与虚拟化相比，不需要额外消耗宿主机的资源，容器体积小，速度快，可移植。</li> <li>随之而来的问题：
<ul><li>如何较为合理地进行资源调度，降低整体集群的负载</li> <li>一个容器由于故障停机，怎样让另一个容器启动去替换停机的容器的服务</li> <li>当并发量变大时，如何及时做到扩展容器数据，提前预防这些异常流量，降低服务器的压力。</li> <li>......</li></ul></li></ul> <p><img src="/assets/img/bushu.7034f6ec.png" alt="部署对比">
这些容器管理的问题统称为容器编排问题，为了解决容器编排问题，就产生了一些容器编排的软件：</p> <ul><li>Swarm: Dockers自己的容器编排工具</li> <li>Mesos: Apache 的一个资源统一管控工具，需要和Marathon结合使用</li> <li>Kubernetes: Google开源的容器编排工具</li></ul> <p><img src="/assets/img/k8s.0e72c41c.png" alt="使用量"></p></li></ul> <h2 id="_1-2-kubernetes简介"><a href="#_1-2-kubernetes简介" class="header-anchor">#</a> 1.2 kubernetes简介</h2> <p>kubernetes简称k8s，是一个全新的基于容器技术的分布式架构领先方案，是谷歌严格保密十几年的秘密武器----Borg系统的一个开源版本，于2014年9月发布第一个版本，2015年7月发布第一个正式版本。
kubernetes本质上是一组服务器集群，目的是实现资源管理的自动化，主要提供如下主要功能：</p> <ul><li>自我修复：一旦某一个容器崩溃，能够在1秒中左右迅速启动新的容器</li> <li>弹性伸缩：可以根据需要，自动对集群中正在运行的容器数量进行调整</li> <li>服务发现：服务可以通过自动发现的形式找到它所依赖的服务</li> <li>负载均衡：如果一个服务起动了多个容器，能够自动实现请求的负载均衡</li> <li>版本回退：如果发现新发布的程序版本有问题，可以立即回退到原来的版本</li> <li>存储编排：可以根据容器自身的需求自动创建存储卷</li></ul> <h2 id="_1-3-kubernetes组件"><a href="#_1-3-kubernetes组件" class="header-anchor">#</a> 1.3 kubernetes组件</h2> <p>一个 Kubernetes集群主要是由控制节点(master)、工作节点(node)构成。</p> <ul><li>master: 集群的控制平面(control-plane)，负责集群的决策(管理)
<ul><li>ApiServer:资源操作的入口，接受用户输入的命令，提供认证、授权、API注册和发现机制</li> <li>Scheduler:负责集群资源调度，按照预定的调度策略将pod调度到相应的pod节点上</li> <li>ControllerManager:负责维护集群状态，比如程序部署安排、故障检测、自动扩展、滚动更新等。</li> <li>Etcd: 负责存储集群中各种资源对象的信息</li></ul></li> <li>node：集群的数据平面，负责为容器提供运行环境 ( 干活 )
<ul><li>Kubelet : 负责维护容器的生命周期，即通过控制docker，来创建、更新、销毁容器</li> <li>KubeProxy : 负责提供集群内部的服务发现和负载均衡</li> <li>Docker : 负责节点上容器的各种操作</li></ul></li></ul> <p><img src="/assets/img/jiagou.edf71e8d.png" alt="内部架构">
下面以部署一个nginx服务来说明kubernetes系统各个组件的调用关系：
1. 首先要明确，一旦kubernetes环境启动之后，master和node都会将自身的信息存储到etcd数据库中
2. 一个nginx服务的安装请求会首先被发送到master节点的apiServer组件
3. apiServer组件会调用scheduler组件来决定到底应该把这个服务安装到哪个node节点上，在此时，它会从etcd中读取各个node节点的信息，然后按照一定的算法进行选择，并将结果告知apiServer
4. apiServer调用controller-manager去调度Node节点安装nginx服务
5. kubelet接收到指令后，会通知docker，然后由docker来启动一个nginx的pod，pod是kubernetes的最小操作单元，容器必须跑在pod中。
6. 一个nginx服务就运行了，如果需要访问nginx，就需要通过kube-proxy来暴露出端口对pod产生访问的代理
这样虚拟机外面就可以本地访问集群中的nginx服务了。</p> <h2 id="_1-4-kubernetes概念"><a href="#_1-4-kubernetes概念" class="header-anchor">#</a> 1.4 kubernetes概念</h2> <p>Master: 集群控制节点，每个集群需要至少一个master节点负责集群的管控
Node: 工作负载节点，由master分配容器到这些node工作节点上，然后node节点上的docker负责容器的运行
Pod: kubernetes的最小控制单元，容器都是运行在pod中的，一个pod中可以有1个或者多个容器
Controller: 控制器，通过它来实现对pod的管理，比如启动pod、停止pod、伸缩pod的数量等等
Service: pod对外服务的统一入口，下面可以维护者同一类的多个pod
Label: 标签，用于对pod进行分类，同一类pod会拥有相同的标签
NameSpace：命名空间，用来隔离pod的运行环境</p> <h1 id="_2-部署方式介绍"><a href="#_2-部署方式介绍" class="header-anchor">#</a> 2 部署方式介绍</h1> <p>1）、kubeadm
Kubeadm 是一个K8s 部署工具，提供kubeadm init 和kubeadm join，用于快速部署Kubernetes 集群。
官方地址：https://kubernetes.io/docs/reference/setup-tools/kubeadm/kubeadm/
2）、二进制包
从github 下载发行版的二进制包，手动部署每个组件，组成Kubernetes 集群。
我这边采用的kubeadm的方式来部署k8s集群的，以便学习更多工作原理</p> <h1 id="_3-资源管理"><a href="#_3-资源管理" class="header-anchor">#</a> 3 资源管理</h1> <p><img src="/assets/img/ziyuan.77f3394e.png" alt="资源管理"></p> <h2 id="_3-1-yaml语言介绍"><a href="#_3-1-yaml语言介绍" class="header-anchor">#</a> 3.1 YAML语言介绍</h2> <p>YAML是一个类似 XML、JSON 的标记性语言。它强调以数据为中心，并不是以标识语言为重点。因而YAML本身的定义比较简单，号称&quot;一种人性化的数据格式语言&quot;。</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">zhangsan</span><span class="token punctuation">:</span> 
 <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">15</span>
 gender：man
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>YAML 语法比较简单，主要下面几个：</p> <ul><li>大小写敏感</li> <li>使用缩进表示层级关系</li> <li>缩进不允许使用tab，只允许使用空格</li> <li>缩进的空格数不重要，只要相同层级的元素左对齐即可</li> <li>'#'表示注释</li></ul> <p>YAML支持以下几种数据类型：</p> <ul><li>纯量：单个的，不可再分的值</li> <li>对象：键值对的集合，又称为映射（mapping）/ 哈希（hash） / 字典（dictionary）</li> <li>数组：一组按次序排列的值，又称为序列（sequence） / 列表（list）</li></ul> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 纯量, 就是指的一个简单的值，字符串、布尔值、整数、浮点数、Null、时间、日期</span>
<span class="token comment"># 1 布尔类型</span>
<span class="token key atrule">c1</span><span class="token punctuation">:</span> true (或者True)
<span class="token comment"># 2 整型</span>
<span class="token key atrule">c2</span><span class="token punctuation">:</span> <span class="token number">234</span>
<span class="token comment"># 3 浮点型</span>
<span class="token key atrule">c3</span><span class="token punctuation">:</span> <span class="token number">3.14</span>
<span class="token comment"># 4 null类型 </span>
<span class="token key atrule">c4</span><span class="token punctuation">:</span> <span class="token null important">~</span>  <span class="token comment"># 使用~表示null</span>
<span class="token comment"># 5 日期类型</span>
<span class="token key atrule">c5</span><span class="token punctuation">:</span> <span class="token datetime number">2018-02-17</span>    <span class="token comment"># 日期必须使用ISO 8601格式，即yyyy-MM-dd</span>
<span class="token comment"># 6 时间类型</span>
<span class="token key atrule">c6</span><span class="token punctuation">:</span> <span class="token datetime number">2018-02-17T15:02:31+08:00</span>  <span class="token comment"># 时间使用ISO 8601格式，时间和日期之间使用T连接，最后使用+代表时区</span>
<span class="token comment"># 7 字符串类型</span>
<span class="token key atrule">c7</span><span class="token punctuation">:</span> zhangsan     <span class="token comment"># 简单写法，直接写值 , 如果字符串中间有特殊字符，必须使用双引号或者单引号包裹 </span>
<span class="token key atrule">c8</span><span class="token punctuation">:</span> line1    
    line2     <span class="token comment"># 字符串过多的情况可以拆成多行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 对象</span>
<span class="token comment"># 形式一(推荐):</span>
<span class="token key atrule">zhangsan</span><span class="token punctuation">:</span>  
    <span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">15</span>  
    <span class="token key atrule">address</span><span class="token punctuation">:</span> Beijing
<span class="token comment"># 形式二(了解):</span>
<span class="token key atrule">zhangsan</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token key atrule">age</span><span class="token punctuation">:</span> <span class="token number">15</span><span class="token punctuation">,</span><span class="token key atrule">address</span><span class="token punctuation">:</span> Beijing<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token comment"># 数组</span>
<span class="token comment"># 形式一(推荐):</span>
<span class="token key atrule">address</span><span class="token punctuation">:</span>  
    <span class="token punctuation">-</span> 顺义  
    <span class="token punctuation">-</span> 昌平  
<span class="token comment"># 形式二(了解):</span>
<span class="token key atrule">address</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>顺义<span class="token punctuation">,</span>昌平<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="_3-2-资源管理方式"><a href="#_3-2-资源管理方式" class="header-anchor">#</a> 3.2 资源管理方式</h2> <ul><li>命令式对象管理：直接使用命令去操作kubernetes资源</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl run nginx-pod <span class="token parameter variable">--image</span><span class="token operator">=</span>nginx:1.17.1 <span class="token parameter variable">--port</span><span class="token operator">=</span><span class="token number">80</span>
<span class="token comment"># nginx-pod 是pod名字，后面是要拉取的镜像版本，容器端口为80</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>命令式对象配置：通过命令配置和配置文件去操作kubernetes资源</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># -f就是指定文件</span>
kubectl create <span class="token parameter variable">-f</span> nginx-pod.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li>声明式对象配置：通过apply命令和配置文件去操作kubernetes资源</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 用于创建或者更新资源</span>
kubectl apply <span class="token parameter variable">-f</span> nginx-pod.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="_3-2-1-命令式对象管理"><a href="#_3-2-1-命令式对象管理" class="header-anchor">#</a> 3.2.1 命令式对象管理</h3> <ul><li>Kubectl</li></ul> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看所有pod</span>
kubctl get pod

<span class="token comment"># 查看某个pod</span>
kubctl get pod pod_name

<span class="token comment"># 查看某个pod,以yaml格式展示结果</span>
kubectl get pod pod_name <span class="token parameter variable">-o</span> yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p>Kubectl [command] [type] [name] [flags]
Command : 对资源执行的操作，create、get、delete
Type: 资源类型，deployment、pod、service
Name: 资源名称
Flags: 额外可选参数</p> <p>经常使用的资源有：</p> <ul><li>集群节点：nodes(no)</li> <li>命名空间： namespaces(ns)</li> <li>pod资源：pods(po)</li> <li>pod资源控制器：replicasets(rs), deployment(deploy),daemonsets(ds),jobs,cronjobs(cj),hpa</li> <li>服务发现资源：services(svc),ingress(ing)</li> <li>存储资源：pv,pvc</li> <li>配置资源：configmaps(cm),secrets</li></ul> <p>常用的k8s的操作，可以通过kubectl --help查看详细的操作命令</p> <h3 id="_3-2-2-命令式对象配置"><a href="#_3-2-2-命令式对象配置" class="header-anchor">#</a> 3.2.2 命令式对象配置</h3> <p>1） 创建一个nginxpod.yaml，内容如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Namespace
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> dev

<span class="token punctuation">---</span>

<span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginxpod
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>containers
    <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>2）执行create命令，创建资源：执行get命令，查看资源：执行delete命令，删除资源：</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kubectl create <span class="token parameter variable">-f</span> nginxpod.yaml
kubectl get <span class="token parameter variable">-f</span> nginxpod.yaml
kubectl delete <span class="token parameter variable">-f</span> nginxpod.yaml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_3-2-3-声明式对象配置"><a href="#_3-2-3-声明式对象配置" class="header-anchor">#</a> 3.2.3 声明式对象配置</h3> <p>声明式对象配置跟命令式对象配置很相似，但是它只有一个命令apply。</p> <p>创建/更新资源 使用声明式对象配置 kubectl apply -f XXX.yaml</p> <p>删除资源 使用命令式对象配置 kubectl delete -f XXX.yaml</p> <p>查询资源 使用命令式对象管理 kubectl get(describe) 资源名称</p> <h1 id="_4-实战"><a href="#_4-实战" class="header-anchor">#</a> 4 实战</h1> <h2 id="_4-1-namespace"><a href="#_4-1-namespace" class="header-anchor">#</a> 4.1 Namespace</h2> <h3 id="_4-1-1-查看"><a href="#_4-1-1-查看" class="header-anchor">#</a> 4.1.1 查看</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 1 查看所有的ns  命令：kubectl get ns</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get ns</span>
NAME              STATUS   AGE
default           Active   45h
kube-node-lease   Active   45h
kube-public       Active   45h     
kube-system       Active   45h     

<span class="token comment"># 2 查看指定的ns   命令：kubectl get ns ns名称</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get ns default</span>
NAME      STATUS   AGE
default   Active   45h

<span class="token comment"># 3 指定输出格式  命令：kubectl get ns ns名称  -o 格式参数</span>
<span class="token comment"># kubernetes支持的格式有很多，比较常见的是wide、json、yaml</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get ns default -o yaml</span>
apiVersion: v1
kind: Namespace
metadata:
  creationTimestamp: <span class="token string">&quot;2021-05-08T04:44:16Z&quot;</span>
  name: default
  resourceVersion: <span class="token string">&quot;151&quot;</span>
  selfLink: /api/v1/namespaces/default
  uid: 7405f73a-e486-43d4-9db6-145f1409f090
spec:
  finalizers:
  - kubernetes
status:
  phase: Active
  
<span class="token comment"># 4 查看ns详情  命令：kubectl describe ns ns名称</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl describe ns default</span>
Name:         default
Labels:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Annotations:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Status:       Active  <span class="token comment"># Active 命名空间正在使用中  Terminating 正在删除命名空间</span>

<span class="token comment"># ResourceQuota 针对namespace做的资源限制</span>
<span class="token comment"># LimitRange针对namespace中的每个组件做的资源限制</span>
No resource quota.
No LimitRange resource.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br></div></div><h3 id="_4-1-2-创建"><a href="#_4-1-2-创建" class="header-anchor">#</a> 4.1.2 创建</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 创建namespace</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl create ns dev</span>
namespace/dev created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-1-3-删除"><a href="#_4-1-3-删除" class="header-anchor">#</a> 4.1.3 删除</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 删除namespace</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete ns dev</span>
namespace <span class="token string">&quot;dev&quot;</span> deleted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="_4-2-pod"><a href="#_4-2-pod" class="header-anchor">#</a> 4.2 Pod</h2> <p>Pod是kubernetes集群进行管理的最小单元，程序要运行必须部署在容器中，而容器必须存在于Pod中。</p> <p>Pod可以认为是容器的封装，一个Pod中可以存在一个或者多个容器。</p> <h3 id="_4-2-1-创建并运行"><a href="#_4-2-1-创建并运行" class="header-anchor">#</a> 4.2.1 创建并运行</h3> <p>kubernetes没有提供单独运行Pod的命令，都是通过Pod控制器来实现的</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 命令格式： kubectl run (pod控制器名称) [参数] </span>
<span class="token comment"># --image  指定Pod的镜像</span>
<span class="token comment"># --port   指定端口</span>
<span class="token comment"># --namespace  指定namespace</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl run nginx --image=nginx:latest --port=80 --namespace dev </span>
deployment.apps/nginx created
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-2-2-查看pod信息"><a href="#_4-2-2-查看pod信息" class="header-anchor">#</a> 4.2.2 查看Pod信息</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 查看Pod基本信息</span>
kubectl get pods <span class="token parameter variable">-n</span> dev

<span class="token comment"># 查看Pod的详细信息</span>
kubectl describe pod nginx <span class="token parameter variable">-n</span> dev

</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h3 id="_4-2-3-访问pod"><a href="#_4-2-3-访问pod" class="header-anchor">#</a> 4.2.3 访问Pod</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 获取podIP</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n dev -o wide</span>
NAME    READY   STATUS    RESTARTS   AGE    IP             NODE    <span class="token punctuation">..</span>. 
nginx   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          190s   <span class="token number">10.244</span>.1.23   node1   <span class="token punctuation">..</span>.

<span class="token comment">#访问POD</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl http://10.244.1.23:80</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
	<span class="token operator">&lt;</span>p<span class="token operator">&gt;</span><span class="token operator">&lt;</span>em<span class="token operator">&gt;</span>Thank you <span class="token keyword">for</span> using nginx.<span class="token operator">&lt;</span>/em<span class="token operator">&gt;</span><span class="token operator">&lt;</span>/p<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><h3 id="_4-2-4-删除指定pod"><a href="#_4-2-4-删除指定pod" class="header-anchor">#</a> 4.2.4 删除指定Pod</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 删除指定Pod</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete pod nginx -n dev</span>
pod <span class="token string">&quot;nginx&quot;</span> deleted

<span class="token comment"># 此时，显示删除Pod成功，但是再查询，发现又新产生了一个 </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n dev</span>
NAME    READY   STATUS    RESTARTS   AGE
nginx   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          21s

<span class="token comment"># 这是因为当前Pod是由Pod控制器创建的，控制器会监控Pod状况，一旦发现Pod死亡，会立即重建</span>
<span class="token comment"># 此时要想删除Pod，必须删除Pod控制器</span>

<span class="token comment"># 先来查询一下当前namespace下的Pod控制器</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy -n  dev</span>
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   <span class="token number">1</span>/1     <span class="token number">1</span>            <span class="token number">1</span>           9m7s

<span class="token comment"># 接下来，删除此PodPod控制器</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete deploy nginx -n dev</span>
deployment.apps <span class="token string">&quot;nginx&quot;</span> deleted

<span class="token comment"># 稍等片刻，再查询Pod，发现Pod被删除了</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n dev</span>
No resources found <span class="token keyword">in</span> dev namespace.
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br></div></div><h3 id="_4-2-5-配置操作"><a href="#_4-2-5-配置操作" class="header-anchor">#</a> 4.2.5 配置操作</h3> <p>创建一个pod-nginx.yaml，内容如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Pod
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">containers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
    <span class="token key atrule">name</span><span class="token punctuation">:</span> pod
    <span class="token key atrule">ports</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx<span class="token punctuation">-</span>port
      <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
      <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>然后就可以执行对应的创建和删除命令了：</p> <p>创建：kubectl create -f pod-nginx.yaml</p> <p>删除：kubectl delete -f pod-nginx.yaml</p> <h2 id="_4-3-label"><a href="#_4-3-label" class="header-anchor">#</a> 4.3 Label</h2> <p>Label是kubernetes系统中的一个重要概念。它的作用就是在资源上添加标识，用来对它们进行区分和选择。</p> <p>Label的特点：</p> <ul><li>一个Label会以key/value键值对的形式附加到各种对象上，如Node、Pod、Service等等</li> <li>一个资源对象可以定义任意数量的Label ，同一个Label也可以被添加到任意数量的资源对象上去</li> <li>Label通常在资源对象定义时确定，当然也可以在对象创建后动态添加或者删除</li></ul> <p>标签定义完毕之后，还要考虑到标签的选择，这就要使用到Label Selector，即：</p> <p>Label用于给某个资源对象定义标识</p> <p>Label Selector用于查询和筛选拥有某些标签的资源对象</p> <h3 id="_4-3-1-命令方式"><a href="#_4-3-1-命令方式" class="header-anchor">#</a> 4.3.1 命令方式</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 为pod资源打标签</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl label pod nginx-pod version=1.0 -n dev</span>
pod/nginx-pod labeled

<span class="token comment"># 为pod资源更新标签</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl label pod nginx-pod version=2.0 -n dev --overwrite</span>
pod/nginx-pod labeled

<span class="token comment"># 查看标签</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod nginx-pod  -n dev --show-labels</span>
NAME        READY   STATUS    RESTARTS   AGE   LABELS
nginx-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          10m   <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2.0</span>

<span class="token comment"># 筛选标签</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n dev -l version=2.0  --show-labels</span>
NAME        READY   STATUS    RESTARTS   AGE   LABELS
nginx-pod   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          17m   <span class="token assign-left variable">version</span><span class="token operator">=</span><span class="token number">2.0</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pod -n dev -l version!=2.0 --show-labels</span>
No resources found <span class="token keyword">in</span> dev namespace.

<span class="token comment">#删除标签</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl label pod nginx-pod -n dev tier-</span>
pod/nginx unlabeled
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><h3 id="_4-3-2-配置方式"><a href="#_4-3-2-配置方式" class="header-anchor">#</a> 4.3.2 配置方式</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>apiVersion: v1
kind: Pod
metadata:
  name: nginx
  namespace: dev
  labels:
    version: <span class="token string">&quot;3.0&quot;</span> 
    env: <span class="token string">&quot;test&quot;</span>
spec:
  containers:
  - image: nginx:latest
    name: pod
    ports:
    - name: nginx-port
      containerPort: <span class="token number">80</span>
      protocol: TCP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br></div></div><p>然后就可以执行对应的更新命令了：kubectl apply -f pod-nginx.yaml</p> <h2 id="_4-4-deployment"><a href="#_4-4-deployment" class="header-anchor">#</a> 4.4 Deployment</h2> <p>在kubernetes中，Pod是最小的控制单元，但是kubernetes很少直接控制Pod，一般都是通过Pod控制器来完成的。Pod控制器用于pod的管理，确保pod资源符合预期的状态，当pod的资源出现故障时，会尝试进行重启或重建pod。</p> <h3 id="_4-4-1-命令操作"><a href="#_4-4-1-命令操作" class="header-anchor">#</a> 4.4.1 命令操作</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 命令格式: kubectl create deployment 名称  [参数] </span>
<span class="token comment"># --image  指定pod的镜像</span>
<span class="token comment"># --port   指定端口</span>
<span class="token comment"># --replicas  指定创建pod数量</span>
<span class="token comment"># --namespace  指定namespace</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl run nginx --image=nginx:latest --port=80 --replicas=3 -n dev</span>
deployment.apps/nginx created

<span class="token comment"># 查看创建的Pod</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get pods -n dev</span>
NAME                     READY   STATUS    RESTARTS   AGE
nginx-5ff7956ff6-6k8cb   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          19s
nginx-5ff7956ff6-jxfjt   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          19s
nginx-5ff7956ff6-v6jqw   <span class="token number">1</span>/1     Running   <span class="token number">0</span>          19s

<span class="token comment"># 查看deployment的信息</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy -n dev</span>
NAME    READY   UP-TO-DATE   AVAILABLE   AGE
nginx   <span class="token number">3</span>/3     <span class="token number">3</span>            <span class="token number">3</span>           2m42s

<span class="token comment"># UP-TO-DATE：成功升级的副本数量</span>
<span class="token comment"># AVAILABLE：可用副本的数量</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get deploy -n dev -o wide</span>
NAME    READY UP-TO-DATE  AVAILABLE   AGE     CONTAINERS   IMAGES              SELECTOR
nginx   <span class="token number">3</span>/3     <span class="token number">3</span>         <span class="token number">3</span>           2m51s   nginx        nginx:latest        <span class="token assign-left variable">run</span><span class="token operator">=</span>nginx

<span class="token comment"># 查看deployment的详细信息</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl describe deploy nginx -n dev</span>
Name:                   nginx
Namespace:              dev
CreationTimestamp:      Wed, 08 May <span class="token number">2021</span> <span class="token number">11</span>:14:14 +0800
Labels:                 <span class="token assign-left variable">run</span><span class="token operator">=</span>nginx
Annotations:            deployment.kubernetes.io/revision: <span class="token number">1</span>
Selector:               <span class="token assign-left variable">run</span><span class="token operator">=</span>nginx
Replicas:               <span class="token number">3</span> desired <span class="token operator">|</span> <span class="token number">3</span> updated <span class="token operator">|</span> <span class="token number">3</span> total <span class="token operator">|</span> <span class="token number">3</span> available <span class="token operator">|</span> <span class="token number">0</span> unavailable
StrategyType:           RollingUpdate
MinReadySeconds:        <span class="token number">0</span>
RollingUpdateStrategy:  <span class="token number">25</span>% max unavailable, <span class="token number">25</span>% max 违规词汇
Pod Template:
  Labels:  <span class="token assign-left variable">run</span><span class="token operator">=</span>nginx
  Containers:
   nginx:
    Image:        nginx:latest
    Port:         <span class="token number">80</span>/TCP
    Host Port:    <span class="token number">0</span>/TCP
    Environment:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
    Mounts:       <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
  Volumes:        <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
Conditions:
  Type           Status  Reason
  ----           ------  ------
  Available      True    MinimumReplicasAvailable
  Progressing    True    NewReplicaSetAvailable
OldReplicaSets:  <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>
NewReplicaSet:   nginx-5ff7956ff6 <span class="token punctuation">(</span><span class="token number">3</span>/3 replicas created<span class="token punctuation">)</span>
Events:
  Type    Reason             Age    From                   Message
  ----    ------             ----   ----                   -------
  Normal  ScalingReplicaSet  5m43s  deployment-controller  Scaled up replicaset nginx-5ff7956ff6 to <span class="token number">3</span>
  
<span class="token comment"># 删除 </span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl delete deploy nginx -n dev</span>
deployment.apps <span class="token string">&quot;nginx&quot;</span> deleted
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br></div></div><h3 id="_4-4-2-配置操作"><a href="#_4-4-2-配置操作" class="header-anchor">#</a> 4.4.2 配置操作</h3> <p>创建一个deploy-nginx.yaml，内容如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> apps/v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Deployment
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">replicas</span><span class="token punctuation">:</span> <span class="token number">3</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">matchLabels</span><span class="token punctuation">:</span>
      <span class="token key atrule">run</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">template</span><span class="token punctuation">:</span>
    <span class="token key atrule">metadata</span><span class="token punctuation">:</span>
      <span class="token key atrule">labels</span><span class="token punctuation">:</span>
        <span class="token key atrule">run</span><span class="token punctuation">:</span> nginx
    <span class="token key atrule">spec</span><span class="token punctuation">:</span>
      <span class="token key atrule">containers</span><span class="token punctuation">:</span>
      <span class="token punctuation">-</span> <span class="token key atrule">image</span><span class="token punctuation">:</span> nginx<span class="token punctuation">:</span>latest
        <span class="token key atrule">name</span><span class="token punctuation">:</span> nginx
        <span class="token key atrule">ports</span><span class="token punctuation">:</span>
        <span class="token punctuation">-</span> <span class="token key atrule">containerPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
          <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p>然后就可以执行对应的创建和删除命令了：</p> <p>创建：kubectl create -f deploy-nginx.yaml</p> <p>删除：kubectl delete -f deploy-nginx.yaml</p> <h2 id="_4-5-service"><a href="#_4-5-service" class="header-anchor">#</a> 4.5 Service</h2> <p>Service可以看作是一组同类Pod对外的访问接口。借助Service，应用可以方便地实现服务发现和负载均衡。</p> <h3 id="_4-5-1-创建集群内部可访问的service"><a href="#_4-5-1-创建集群内部可访问的service" class="header-anchor">#</a> 4.5.1 创建集群内部可访问的Service</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 暴露Service</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl expose deploy nginx --name=svc-nginx1 --type=ClusterIP --port=80 --target-port=80 -n dev</span>
service/svc-nginx1 exposed

<span class="token comment"># 查看service</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc svc-nginx1 -n dev -o wide</span>
NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>   AGE     SELECTOR
svc-nginx1   ClusterIP   <span class="token number">10.109</span>.179.231   <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>/TCP    3m51s   <span class="token assign-left variable">run</span><span class="token operator">=</span>nginx

<span class="token comment"># 这里产生了一个CLUSTER-IP，这就是service的IP，在Service的生命周期中，这个地址是不会变动的</span>
<span class="token comment"># 可以通过这个IP访问当前service对应的POD</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># curl 10.109.179.231:80</span>
<span class="token operator">&lt;</span><span class="token operator">!</span>DOCTYPE html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>html<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>title<span class="token operator">&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/title<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/head<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>Welcome to nginx<span class="token operator">!</span><span class="token operator">&lt;</span>/h<span class="token operator"><span class="token file-descriptor important">1</span>&gt;</span>
<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.
<span class="token operator">&lt;</span>/body<span class="token operator">&gt;</span>
<span class="token operator">&lt;</span>/html<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h3 id="_4-5-2-创建集群外部也可访问的service"><a href="#_4-5-2-创建集群外部也可访问的service" class="header-anchor">#</a> 4.5.2 创建集群外部也可访问的Service</h3> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code><span class="token comment"># 上面创建的Service的type类型为ClusterIP，这个ip地址只用集群内部可访问</span>
<span class="token comment"># 如果需要创建外部也可以访问的Service，需要修改type为NodePort</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl expose deploy nginx --name=svc-nginx2 --type=NodePort --port=80 --target-port=80 -n dev</span>
service/svc-nginx2 exposed

<span class="token comment"># 此时查看，会发现出现了NodePort类型的Service，而且有一对Port（80:31928/TC）</span>
<span class="token punctuation">[</span>root@master ~<span class="token punctuation">]</span><span class="token comment"># kubectl get svc  svc-nginx2  -n dev -o wide</span>
NAME          TYPE        CLUSTER-IP       EXTERNAL-IP   PORT<span class="token punctuation">(</span>S<span class="token punctuation">)</span>        AGE    SELECTOR
svc-nginx2    NodePort    <span class="token number">10.100</span>.94.0      <span class="token operator">&lt;</span>none<span class="token operator">&gt;</span>        <span class="token number">80</span>:31928/TCP   9s     <span class="token assign-left variable">run</span><span class="token operator">=</span>nginx

<span class="token comment"># 接下来就可以通过集群外的主机访问 节点IP:31928访问服务了</span>
<span class="token comment"># 例如在的电脑主机上通过浏览器访问下面的地址</span>
http://192.168.90.100:31928/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><h4 id="_4-5-4-配置方式"><a href="#_4-5-4-配置方式" class="header-anchor">#</a> 4.5.4 配置方式</h4> <p>创建一个svc-nginx.yaml，内容如下：</p> <div class="language-yaml line-numbers-mode"><pre class="language-yaml"><code><span class="token key atrule">apiVersion</span><span class="token punctuation">:</span> v1
<span class="token key atrule">kind</span><span class="token punctuation">:</span> Service
<span class="token key atrule">metadata</span><span class="token punctuation">:</span>
  <span class="token key atrule">name</span><span class="token punctuation">:</span> svc<span class="token punctuation">-</span>nginx
  <span class="token key atrule">namespace</span><span class="token punctuation">:</span> dev
<span class="token key atrule">spec</span><span class="token punctuation">:</span>
  <span class="token key atrule">clusterIP</span><span class="token punctuation">:</span> 10.109.179.231 <span class="token comment">#固定svc的内网ip</span>
  <span class="token key atrule">ports</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">port</span><span class="token punctuation">:</span> <span class="token number">80</span>
    <span class="token key atrule">protocol</span><span class="token punctuation">:</span> TCP
    <span class="token key atrule">targetPort</span><span class="token punctuation">:</span> <span class="token number">80</span>
  <span class="token key atrule">selector</span><span class="token punctuation">:</span>
    <span class="token key atrule">run</span><span class="token punctuation">:</span> nginx
  <span class="token key atrule">type</span><span class="token punctuation">:</span> ClusterIP
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><p>然后就可以执行对应的创建和删除命令了：</p> <p>创建：kubectl create -f svc-nginx.yaml</p> <p>删除：kubectl delete -f svc-nginx.yaml</p></div></div>  <div class="page-edit"><!----> <!----> <!----></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/pages/08838f/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">Pod相关</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/pages/08838f/">Pod相关</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/d2b13d/"><div>
            实习技术
            <!----></div></a> <span class="date">08-24</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/39be8a/"><div>
            sql
            <!----></div></a> <span class="date">07-28</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/4375ac/"><div>
            git命令
            <!----></div></a> <span class="date">07-26</span></dt></dl> <dl><dd></dd> <dt><a href="/archives" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="https://www.zhihu.com/people/zhi-qing-72-50" title="知乎" target="_blank" class="iconfont icon-zhihu"></a><a href="https://github.com/jinhua0" title="GitHub" target="_blank" class="iconfont icon-github"></a><a href="https://space.bilibili.com/352135891?spm_id_from=333.337.0.0" title="blibli" target="_blank" class="iconfont icon-bilibili"></a><a href="er2578912608@163.com" title="邮箱" target="_blank" class="iconfont icon-youjian"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2019-2023
    <span>Evan Xu | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.7087f587.js" defer></script><script src="/assets/js/2.e7663ce2.js" defer></script><script src="/assets/js/3.c4ac17a7.js" defer></script>
  </body>
</html>
